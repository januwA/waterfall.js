{"version":3,"file":"waterfall.js","sources":["../src/waterfall.ts"],"sourcesContent":["enum WaterfallAlignment {\r\n  start,\r\n  center,\r\n  end,\r\n  between\r\n}\r\ninterface WaterfallOptions {\r\n  root: string;\r\n  item: string;\r\n  alignment?: WaterfallAlignment;\r\n  reverse?: boolean;\r\n  resizeDebounce?: number;\r\n  resize?: boolean;\r\n}\r\n\r\nclass Waterfall {\r\n\r\n  /**\r\n   * * 根元素节点\r\n   */\r\n  public rootElm: HTMLElement;\r\n\r\n  /**\r\n   * * version [0.1.1]\r\n   * * Github: https://github.com/januwA/waterfall.js\r\n   * * Example: https://januwa.github.io/waterfall.js/example/index.html\r\n   */\r\n  public version: string = \"0.1.1\";\r\n\r\n  /**\r\n   * * 根节点选择器\r\n   */\r\n  public root: string;\r\n\r\n  /**\r\n   * * 子节点选择器\r\n   */\r\n  public item: string;\r\n\r\n  /**\r\n   * * 子节点对齐方式\r\n   * * default is [WaterfallAlignment.start]\r\n   */\r\n  public alignment = WaterfallAlignment.start;\r\n\r\n  /**\r\n   * * 每行是否颠倒\r\n   * * default is [false]\r\n   */\r\n  public reverse = false;\r\n\r\n  /**\r\n   * * [window.resize]事件防抖，毫秒为单位\r\n   * * default is [300]\r\n   */\r\n  public resizeDebounce = 300;\r\n\r\n  /**\r\n   * * 是否响应resize事件\r\n   */\r\n  public resize = true;\r\n\r\n  constructor({\r\n    root,\r\n    item,\r\n    alignment = WaterfallAlignment.start /*start|center|end|between*/,\r\n    reverse = false /*true|false*/,\r\n    resizeDebounce = 300 /*resize事件的防抖时间*/,\r\n    resize = true\r\n  }: WaterfallOptions) {\r\n    if (!root || !item) {\r\n      throw Error(`构建方式错误: 需要root和item参数!`);\r\n    }\r\n    this.root = root;\r\n    this.item = item;\r\n    this.alignment = alignment;\r\n    this.reverse = reverse;\r\n    this.resizeDebounce = resizeDebounce;\r\n    this.resize = resize;\r\n\r\n    const rootElm: HTMLElement | null = document.querySelector<HTMLElement>(\r\n      this.root\r\n    );\r\n    if (rootElm === null) throw Error(`没有找到根节点：\"${this.root}\" 元素！`);\r\n    this.rootElm = rootElm;\r\n    if (this._getPV(this.rootElm, \"position\") === \"static\") {\r\n      this.rootElm.style[\"position\"] = \"relative\";\r\n    }\r\n\r\n    this._run();\r\n  }\r\n\r\n  /**\r\n   * 一个防抖函数，在[t]时间内事件重复会被丢弃，只发出最新值\r\n   * @param {*} fn 需要防抖的函数\r\n   * @param {*} t  毫秒\r\n   */\r\n  public debounce(fn: Function, t = 1000): Function {\r\n    let _debunce: number;\r\n    return (...args: any[]) => {\r\n      clearTimeout(_debunce);\r\n      _debunce = setTimeout(() => {\r\n        fn.apply(this, args);\r\n      }, t);\r\n    };\r\n  }\r\n\r\n  private debounceDraw: any;\r\n  /**\r\n   * * 初始化\r\n   */\r\n  private _run(): void {\r\n    window.addEventListener(\"load\", this.draw);\r\n    if (this.resize) {\r\n      this.debounceDraw = this.debounce(this.draw, this.resizeDebounce);\r\n      window.addEventListener(\"resize\", this.debounceDraw);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取dom元素的属性信息\r\n   * @param el  dom元素\r\n   * @param prop  属性名\r\n   */\r\n  private _getPV(el: Element, prop: string) {\r\n    return document\r\n      .defaultView!.getComputedStyle(el, null)\r\n      .getPropertyValue(prop);\r\n  }\r\n\r\n  /**\r\n   * * 开始设置瀑布流\r\n   */\r\n  public draw = () => {\r\n    const itemWidth: number = document.querySelector<HTMLElement>(this.item)!\r\n      .clientWidth;\r\n    const rootWidth: number = this.rootElm.clientWidth;\r\n    // 获取图片的列数\r\n    let column = parseInt((rootWidth / itemWidth).toString());\r\n\r\n    // 高度数组\r\n    let heightArr = [];\r\n    for (let i = 0; i < column; i++) {\r\n      heightArr[i] = 0;\r\n    }\r\n\r\n    const overflowWidth = rootWidth - itemWidth * column;\r\n    const columnWidth = rootWidth / column;\r\n\r\n    const children = Array.from<HTMLElement>(\r\n      this.rootElm.querySelectorAll(this.item)\r\n    );\r\n\r\n    // 遍历所有图片进行定位处理\r\n    for (let i = 0; i < children.length; i++) {\r\n      const item = children[i];\r\n\r\n      // item height\r\n      let itemHeight = item.clientHeight;\r\n\r\n      // 高度数组最小的高度\r\n      let minHeight = Math.min(...heightArr);\r\n      // 高度数组最小的高度的索引\r\n      let minIndex = heightArr.indexOf(minHeight);\r\n\r\n      item.style[\"position\"] = \"absolute\";\r\n      item.style[\"top\"] = minHeight + \"px\";\r\n      let _left;\r\n      let index = this.reverse ? column - 1 - minIndex : minIndex;\r\n      switch (this.alignment) {\r\n        case WaterfallAlignment.start:\r\n          _left = index * itemWidth;\r\n          break;\r\n        case WaterfallAlignment.center:\r\n          _left = index * itemWidth + overflowWidth / 2;\r\n          break;\r\n        case WaterfallAlignment.end:\r\n          _left = index * itemWidth + overflowWidth;\r\n          break;\r\n        case WaterfallAlignment.between:\r\n          let x = 0;\r\n          if (minIndex > 0) {\r\n            x = overflowWidth / column / (column - minIndex);\r\n          }\r\n          _left = index * columnWidth + x;\r\n          break;\r\n      }\r\n      item.style[\"left\"] = _left + \"px\";\r\n      heightArr[minIndex] += itemHeight;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * * 清理资源\r\n   */\r\n  public dispose(): void {\r\n    window.removeEventListener(\"load\", this.draw);\r\n    if (this.resize) window.removeEventListener(\"resize\", this.debounceDraw);\r\n  }\r\n}\r\n\r\nexport { WaterfallAlignment, Waterfall };\r\n"],"names":["WaterfallAlignment"],"mappings":"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"}